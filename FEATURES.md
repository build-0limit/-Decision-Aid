# 功能详解

## ⚙️ 配置中心

### 核心功能
- **可视化配置界面**：无需修改代码或环境变量
- **多服务商支持**：OpenAI、Anthropic、自定义 API
- **本地存储**：配置自动保存到浏览器
- **连接测试**：验证配置是否正确
- **安全管理**：API Key 本地加密存储

### 支持的服务商
1. **演示模式**：使用预设数据，无需 API
2. **OpenAI**：GPT-4、GPT-4 Turbo、GPT-3.5 Turbo
3. **Anthropic**：Claude 3 Opus、Sonnet、Haiku
4. **自定义 API**：任何兼容 OpenAI 格式的 API

### 配置参数
- **API Key**：服务商提供的密钥
- **模型选择**：根据需求选择合适的模型
- **Temperature**：控制输出的随机性（0-2）
- **API 端点**：自定义 API 的完整 URL
- **本地保存**：是否保存配置到浏览器

## 🌳 树形可视化

### 核心特性
- **自动布局算法**：根据决策树结构自动计算节点位置
- **SVG渲染**：使用SVG实现高质量的矢量图形
- **响应式设计**：自动适应容器宽度，支持横向滚动

### 节点类型
1. **普通节点** (❓)：未访问的决策点
2. **已访问节点** (✓)：用户已经经过的节点
3. **当前节点** (👉)：用户当前所在的决策点，带脉冲动画
4. **结果节点** (🎯)：最终的决策结果

### 连接线样式
- **默认状态**：灰色细线
- **已访问路径**：深灰色粗线
- **当前激活路径**：紫色粗线，带流动动画效果

## ✨ 动画效果

### 1. 节点动画
- **脉冲效果**：当前节点持续的缩放脉冲动画
- **图标跳动**：当前节点图标上下跳动
- **悬停效果**：鼠标悬停时节点放大

### 2. 路径动画
- **流动效果**：激活路径的虚线流动动画
- **颜色过渡**：路径状态变化时的平滑颜色过渡

### 3. 界面动画
- **卡片滑入**：决策卡片从下方滑入
- **选项悬停**：选项按钮的滑动和阴影效果
- **进度条**：平滑的进度条填充动画

## 🎮 交互功能

### 用户操作
1. **选择选项**：点击选项按钮进行决策
2. **返回上一步**：支持撤销最后一次选择
3. **查看树结构**：实时查看完整的决策树
4. **点击节点**：可以点击树上的节点（预留交互接口）

### 状态追踪
- **当前位置**：实时高亮显示用户当前所在节点
- **访问历史**：记录并显示用户的完整决策路径
- **进度显示**：顶部进度条显示决策进度

## 🎨 视觉设计

### 色彩方案
- **主色调**：紫色渐变 (#667eea → #764ba2)
- **节点颜色**：
  - 未访问：浅灰色 (#f0f0f0)
  - 已访问：中灰色 (#d0d0d0)
  - 当前：紫色 (#667eea)
  - 结果：绿色 (#4caf50)

### 布局特点
- **居中对齐**：所有内容居中显示
- **卡片设计**：使用圆角卡片和阴影
- **间距合理**：充足的留白和间距
- **层次清晰**：通过大小、颜色、阴影区分层次

## 🔧 技术实现

### 配置管理
```javascript
// 保存配置到 localStorage
setApiConfig(config)

// 读取配置
const config = getApiConfig()

// 测试 API 连接
await testApiConnection(config)
```

### LLM API 调用
- 支持 OpenAI Chat Completions API
- 支持 Anthropic Messages API
- 支持自定义 API 端点
- 自动错误处理和重试
- 失败时回退到演示模式

### 树布局算法
```javascript
// 递归遍历树结构
// 根据深度计算Y坐标
// 根据兄弟节点数量和索引计算X坐标
// 使用贝塞尔曲线连接父子节点
```

### 动画实现
- CSS动画：用于简单的循环动画（脉冲、跳动）
- CSS过渡：用于状态变化的平滑过渡
- SVG动画：用于路径的流动效果

### 响应式策略
- 容器宽度自适应
- SVG尺寸动态计算
- 横向滚动支持
- 移动端优化

## 📊 数据流

```
用户打开配置中心
    ↓
选择服务商和配置参数
    ↓
测试 API 连接（可选）
    ↓
保存配置到 localStorage
    ↓
用户输入问题
    ↓
根据配置调用 LLM API 或使用演示数据
    ↓
LLM生成决策树 JSON
    ↓
计算树布局
    ↓
渲染SVG可视化
    ↓
用户进行选择
    ↓
更新当前节点（带动画）
    ↓
更新访问路径（高亮）
    ↓
继续或得到结果
```

## 🚀 性能优化

- 使用Vue的响应式系统高效更新
- SVG元素复用，减少DOM操作
- 动画使用CSS而非JavaScript
- 合理的组件拆分和懒加载


## 🔗 分享功能

### 核心特性
- **一键分享**：完成决策后点击按钮即可生成分享链接
- **短链接**：自动生成 7 位短代码，易于分享
- **自定义代码**：支持自定义分享代码（可选）
- **完整保存**：保存决策树、路径和结果
- **只读查看**：分享接收者只能查看，不能修改

### 分享内容
1. **原始问题**：用户输入的决策问题
2. **决策树结构**：完整的决策树数据
3. **决策路径**：用户的选择历史
4. **最终结果**：决策的最终建议
5. **创建时间**：分享创建的时间戳
6. **备注信息**：可选的备注说明

### 使用流程

#### 创建分享
1. 完成决策，到达结果页面
2. 点击"🔗 分享决策树"按钮
3. 系统调用 API 创建分享记录
4. 生成唯一的分享链接
5. 显示链接和复制按钮
6. 点击"复制链接"一键复制

#### 查看分享
1. 打开分享链接（`/share/{code}`）
2. 系统自动检测 URL 路径
3. 调用 API 获取分享数据
4. 渲染决策树可视化
5. 显示决策路径和结果
6. 提供"创建我的决策"按钮

### 技术实现

#### 后端 API
```javascript
// 创建分享
POST /api/shares
{
  "question": "决策问题",
  "decisionTree": { /* 树结构 */ },
  "decisionPath": ["选项1", "选项2"],
  "finalResult": "最终结果",
  "code": "custom" // 可选
}

// 获取分享
GET /api/shares/{code}

// 删除分享
DELETE /api/shares/{code}
```

#### 前端实现
```javascript
// 创建分享
async function shareDecision() {
  const response = await fetch('/api/shares', {
    method: 'POST',
    body: JSON.stringify({
      question, decisionTree, decisionPath, finalResult
    })
  })
  const data = await response.json()
  shareLink.value = `${origin}/share/${data.code}`
}

// 加载分享
async function loadSharedDecision(code) {
  const response = await fetch(`/api/shares/${code}`)
  const data = await response.json()
  // 渲染分享的决策树
}
```

### 用户界面

#### 分享按钮
- 位置：结果页面，决策路径下方
- 样式：绿色渐变按钮
- 状态：加载中显示"生成中..."
- 图标：🔗 链接图标

#### 分享结果
- 输入框：显示完整链接，只读
- 复制按钮：一键复制，成功后显示"✓ 已复制"
- 动画：滑入动画效果

#### 分享查看页
- 标题：🌐 分享的决策
- 问题显示：高亮显示原始问题
- 树形可视化：完整的决策树
- 路径展示：决策路径列表
- 结果显示：最终决策结果
- 操作按钮：创建我的决策

### 扩展功能（未来）
- 自定义过期时间
- 分享密码保护
- 访问统计和分析
- 评论和反馈
- 导出为图片/PDF
- 社交媒体快捷分享
- 分享管理面板
- 批量删除分享

### 使用场景
1. **团队协作**：分享决策过程给团队成员
2. **咨询建议**：向专家展示决策思路
3. **教学演示**：展示决策分析方法
4. **记录存档**：保存重要决策过程
5. **社交分享**：分享有趣的决策给朋友
